# These hashes allow us to iterate across a series of test data
# creating rspec examples for each parameter to ensure the input :line
# extrapolates to the desired value for the parameter in question. And
# vice-versa

# This hash is for testing a line conversion to a hash of parameters
# which will be used to create a resource.
ARGS_TO_HASH6 = {
  'source_destination_ipv6_no_cidr' => {
    line: '-A INPUT -s 2001:db8:85a3::8a2e:370:7334 -d 2001:db8:85a3::8a2e:370:7334 -m comment --comment "000 source destination ipv6 no cidr"',
    table: 'filter',
    provider: 'ip6tables',
    params: {
      source: '2001:db8:85a3::8a2e:370:7334/128',
      destination: '2001:db8:85a3::8a2e:370:7334/128',
    },
  },
  'source_destination_ipv6_netmask' => {
    line: '-A INPUT -s 2001:db8:1234::/ffff:ffff:ffff:0000:0000:0000:0000:0000 -d 2001:db8:4321::/ffff:ffff:ffff:0000:0000:0000:0000:0000 -m comment --comment "000 source destination ipv6 netmask"',
    table: 'filter',
    provider: 'ip6tables',
    params: {
      source: '2001:db8:1234::/48',
      destination: '2001:db8:4321::/48',
    },
  },
  'frag_ishasmorefrags' => {
    line: '-A INPUT -p tcp -m frag --fragid 0 --fragmore -m comment --comment "100 has more fragments"',
    params: {
      name: '100 has more fragments',
      chain: 'INPUT',
      proto: 'tcp',
      ishasmorefrags: true,
    },
  },
  'frag_islastfrag' => {
    line: '-A INPUT -p tcp -m frag --fragid 0 --fraglast -m comment --comment "100 last fragment"',
    params: {
      name: '100 last fragment',
      chain: 'INPUT',
      islastfrag: true,
    },
  },
  'frag_isfirstfrags' => {
    line: '-A INPUT -p tcp -m frag --fragid 0 --fragfirst -m comment --comment "100 first fragment"',
    params: {
      name: '100 first fragment',
      chain: 'INPUT',
      isfirstfrag: true,
    },
  },
  'udp_source_port_and_destination_port' => {
    line: '-A ufw6-before-input -s fe80::/10 -d fe80::/10 -p udp -m udp --sport 547 --dport 546 -j ACCEPT',
    table: 'filter',
    provider: 'ip6tables',
    params: {
      proto: 'udp',
      sport: ['547'],
      dport: ['546'],
    },
  },
  'hexstring_matching_1' => {
    line: '-A INPUT -m string --hex-string "|0000FF0001|" --algo bm',
    table: 'filter',
    params: {
      string_hex: '|0000FF0001|',
      string_algo: 'bm',
    },
  },
  'random-fully' => {
    line: '-A KUBE-POSTROUTING -m comment --comment "kubernetes service traffic requiring SNAT" -j MASQUERADE --random-fully',
    table: 'filter',
    provider: 'ip6tables',
    params: {
      random_fully: 'true',
    }
  },
  'match_mss' => {
    line: '-A FORWARD -p tcp -m tcp --tcp-flags SYN,RST SYN -m tcpmss --mss 1361:1541 -m comment --comment "604 - set_mss" -j TCPMSS --set-mss 1360',
    compare_all: true,
    table: 'filter',
    params: {
      line: '-A FORWARD -p tcp -m tcp --tcp-flags SYN,RST SYN -m tcpmss --mss 1361:1541 -m comment --comment "604 - set_mss" -j TCPMSS --set-mss 1360',
      name: '604 - set_mss',
      provider: 'ip6tables',
      ensure: :present,
      table: 'filter',
      chain: 'FORWARD',
      proto: 'tcp',
      tcp_flags: 'SYN,RST SYN',
      mss: '1361:1541',
      jump: 'TCPMSS',
      set_mss: '1360',
    },
  },
  'match_mss_with_synproxy' => {
    line: '-A FORWARD -p tcp -m tcp --tcp-flags SYN,RST SYN -m tcpmss --mss 1361:1541 -m comment --comment "604 - proxy SYN in range" -j SYNPROXY --mss 1360',
    compare_all: true,
    table: 'filter',
    params: {
      line: '-A FORWARD -p tcp -m tcp --tcp-flags SYN,RST SYN -m tcpmss --mss 1361:1541 -m comment --comment "604 - proxy SYN in range" -j SYNPROXY --mss 1360',
      name: '604 - proxy SYN in range',
      provider: 'ip6tables',
      ensure: :present,
      table: 'filter',
      chain: 'FORWARD',
      proto: 'tcp',
      tcp_flags: 'SYN,RST SYN',
      mss: '1361:1541',
      jump: 'SYNPROXY',
      synproxy_mss: '1360',
    },
  },
  'parses_synproxy_rule' => {
    line: '-A INPUT -p tcp -m tcp --dport 80 -m comment --comment "001 parses rule with synproxy target" -j SYNPROXY --sack-perm --timestamp --wscale 9 --mss 1460 --ecn',
    compare_all: true,
    table: 'filter',
    params: {
      chain: 'INPUT',
      dport: ['80'],
      ensure: :present,
      jump: 'SYNPROXY',
      line: '-A INPUT -p tcp -m tcp --dport 80 -m comment --comment "001 parses rule with synproxy target" -j SYNPROXY --sack-perm --timestamp --wscale 9 --mss 1460 --ecn',
      name: '001 parses rule with synproxy target',
      proto: 'tcp',
      provider: 'ip6tables',
      synproxy_ecn: true,
      synproxy_mss: '1460',
      synproxy_sack_perm: true,
      synproxy_timestamp: true,
      synproxy_wscale: '9',
      table: 'filter',
    },
  },
  'parses_synproxy_rule_without_booleans' => {
    line: '-A INPUT -p tcp -m tcp --dport 80 -m comment --comment "001 parses rule with synproxy target" -j SYNPROXY --wscale 9 --mss 1460',
    compare_all: true,
    table: 'filter',
    params: {
      chain: 'INPUT',
      dport: ['80'],
      ensure: :present,
      jump: 'SYNPROXY',
      line: '-A INPUT -p tcp -m tcp --dport 80 -m comment --comment "001 parses rule with synproxy target" -j SYNPROXY --wscale 9 --mss 1460',
      name: '001 parses rule with synproxy target',
      proto: 'tcp',
      provider: 'ip6tables',
      synproxy_mss: '1460',
      synproxy_wscale: '9',
      table: 'filter',
    },
  },
  'nflog_options_using_range' => {
    line: '-A INPUT -p all -m comment --comment "503 - test" -j NFLOG --nflog-group 3 --nflog-prefix "TEST PREFIX" --nflog-range 16 --nflog-threshold 2',
    params: {
      name: '503 - test',
      proto: 'all',
      jump:  'NFLOG',
      nflog_group: '3',
      nflog_prefix: 'TEST PREFIX',
      nflog_range: '16',
      nflog_threshold: '2',
    },
  },
  'nflog_options_using_size' => {
    line: '-A INPUT -p all -m comment --comment "503 - test" -j NFLOG --nflog-group 3 --nflog-prefix "TEST PREFIX" --nflog-size 16 --nflog-threshold 2',
    params: {
      name: '503 - test',
      proto: 'all',
      jump:  'NFLOG',
      nflog_group: '3',
      nflog_prefix: 'TEST PREFIX',
      nflog_size: '16',
      nflog_threshold: '2',
    },
  },
  # NETMAP's '--to' isn't implemented for the ip6tables provider
  # 'netmap_to' => {
  #   line: '-A POSTROUTING -d 200.200.200.200/32 -p tcp -m comment --comment "569 - test" -j NETMAP --to 192.168.1.1',
  #   params: {
  #     name: '569 - test',
  #     chain: 'POSTROUTING',
  #     proto: 'tcp',
  #     destination: '200.200.200.200/32',
  #     jump: 'NETMAP',
  #     to: '192.168.1.1',
  #   },
  # },
  'snat_to_source' => {
    line: '-A POSTROUTING -p tcp -m comment --comment "568 - tosource" -j SNAT --to-source 3b71:db9:4321::3',
    params: {
      name: '568 - tosource',
      chain: 'POSTROUTING',
      proto: 'tcp',
      jump: 'SNAT',
      tosource: '3b71:db9:4321::3',
    },
  },
  'dnat_to_dest' => {
    line: '-A PREROUTING -s 3b71:db9:1234::3 -p tcp -m comment --comment "569 - todest" -j DNAT --to-destination 2001:db8:4321::1',
    params: {
      name: '569 - todest',
      chain: 'PREROUTING',
      proto: 'tcp',
      jump: 'DNAT',
      source: '3b71:db9:1234::3/128',
      todest: '2001:db8:4321::1',
    },
  },
  'redirect_to_ports' => {
    line: '-A PREROUTING -p icmp -m comment --comment "574 - toports" -j REDIRECT --to-ports 2222',
    params: {
      name: '574 - toports',
      chain: 'PREROUTING',
      proto: 'icmp',
      jump: 'REDIRECT',
      toports: '2222',
    },
  },
  'tee_gateway' => {
    line: '-A PREROUTING -m comment --comment "810 - tee_gateway" -j TEE --gateway 2001:db8:4321::1',
    params: {
      name: '810 - tee_gateway',
      chain: 'PREROUTING',
      proto: 'all',
      jump: 'TEE',
      gateway: '2001:db8:4321::1',
    },
  },
  'match_time' => {
    line: '-A OUTPUT -p tcp -m multiport --dports 8080 -m time --timestart 06:00:00 --timestop 17:00:00 --monthdays 7 --weekdays Tue --datestart 2016-01-19T04:17:07 --datestop 2038-01-19T04:17:07 --kerneltz -m comment --comment "805 - test" -j ACCEPT',
    params: {
      name: '805 - test',
      chain: 'OUTPUT',
      proto: 'tcp',
      dport: ['8080'],
      date_start: '2016-01-19T04:17:07',
      date_stop: '2038-01-19T04:17:07',
      time_start: '06:00:00',
      time_stop: '17:00:00',
      month_days: '7',
      week_days: 'Tue',
      kernel_timezone: true,
      action: 'accept',
    },
  },
  'checksum_fill' => {
    line: '-A POSTROUTING -o virbr0 -p udp -m multiport --dports 68 -m comment --comment "576 - test" -j CHECKSUM --checksum-fill',
    params: {
      name: '576 - test',
      chain: 'POSTROUTING',
      proto: 'udp',
      outiface: 'virbr0',
      dport: ['68'],
      jump: 'CHECKSUM',
      checksum_fill: true,
    },
  },
  'hashlimit_above' => {
    line: '-A INPUT -p tcp -m hashlimit --hashlimit-above 16/sec --hashlimit-mode srcip,dstip --hashlimit-name above --hashlimit-htable-gcinterval 10 -m comment --comment "805 - hashlimit_above test" -j ACCEPT',
    params: {
      name: '805 - hashlimit_above test',
      chain: 'INPUT',
      proto: 'tcp',
      hashlimit_name: 'above',
      hashlimit_above: '16/sec',
      hashlimit_htable_gcinterval: '10',
      hashlimit_mode: 'srcip,dstip',
      action: 'accept',
    },
  },
  'hashlimit_upto' => {
    line: '-A INPUT -p tcp -m hashlimit --hashlimit-upto 16/sec --hashlimit-burst 640 --hashlimit-name upto --hashlimit-htable-size 1000000 --hashlimit-htable-max 320000 --hashlimit-htable-expire 36000000 -m comment --comment "806 - hashlimit_upto test" -j ACCEPT',
    params: {
      name: '806 - hashlimit_upto test',
      chain: 'INPUT',
      proto: 'tcp',
      hashlimit_name: 'upto',
      hashlimit_upto: '16/sec',
      hashlimit_burst: '640',
      hashlimit_htable_size: '1000000',
      hashlimit_htable_max: '320000',
      hashlimit_htable_expire: '36000000',
      action: 'accept',
    },
  },
  'condition' => {
    line: '-A INPUT -i enp0s8 -p icmp -m condition ! --condition "isblue" -m comment --comment "010 isblue ipv4" -j DROP',
    params: {
      name: '010 isblue ipv4',
      chain: 'INPUT',
      proto: 'icmp',
      condition: '! isblue',
      iniface: 'enp0s8',
      action: 'drop',
    },
  },
  'ipsec_out_policy_ipsec' => {
    line: '-A OUTPUT -d 2001:db8:4321::/64 -m policy --dir out --pol ipsec -m comment --comment "595 - ipsec_policy ipsec and out" -j REJECT --reject-with icmp-net-unreachable',
    params: {
      name: '595 - ipsec_policy ipsec and out',
      chain: 'OUTPUT',
      proto: 'all',
      destination: '2001:db8:4321::/64',
      ipsec_dir: 'out',
      ipsec_policy: 'ipsec',
      action: 'reject',
      reject: 'icmp-net-unreachable',
    },
  },
  'ipsec_in_policy_none' => {
    line: '-A INPUT -d 2001:db8:4321::/64 -m policy --dir in --pol none -m comment --comment "596 - ipsec_policy none and in" -j REJECT --reject-with icmp-net-unreachable',
    params: {
      name: '596 - ipsec_policy none and in',
      chain: 'INPUT',
      proto: 'all',
      destination: '2001:db8:4321::/64',
      ipsec_dir: 'in',
      ipsec_policy: 'none',
      action: 'reject',
      reject: 'icmp-net-unreachable',
    },
  },
  'recent_set_rdest' => {
    line: '-A INPUT -d 2001:db8:4321::/64 -m recent --set --name list1 --mask 255.255.255.255 --rdest -m comment --comment "597 - recent set"',
    params: {
      name: '597 - recent set',
      chain: 'INPUT',
      proto: 'all',
      destination: '2001:db8:4321::/64',
      recent: 'set',
      rdest: true,
      rname: 'list1',
    },
  },
  'recent_rcheck_complex' => {
    line: '-A INPUT -d 2001:db8:4321::/64 -m recent --rcheck --seconds 60 --hitcount 5 --rttl --name list1 --mask 255.255.255.255 --rsource -m comment --comment "598 - recent rcheck"',
    params: {
      name: '598 - recent rcheck',
      chain: 'INPUT',
      proto: 'all',
      destination: '2001:db8:4321::/64',
      recent: 'rcheck',
      rsource: true,
      rname: 'list1',
      rseconds: '60',
      rhitcount: '5',
      rttl: true,
    },
  },
  'recent_update_simple' => {
    line: '-A INPUT -d 2001:db8:4321::/64 -m recent --update --name DEFAULT --mask 255.255.255.255 --rsource -m comment --comment "599 - recent update"',
    params: {
      name: '599 - recent update',
      chain: 'INPUT',
      proto: 'all',
      destination: '2001:db8:4321::/64',
      recent: 'update',
      rname: 'DEFAULT',
    },
  },
  'recent_remove' => {
    line: '-A INPUT -d 2001:db8:4321::/64 -m recent --remove --name DEFAULT --mask 255.255.255.255 --rsource -m comment --comment "600 - recent remove"',
    params: {
      name: '600 - recent remove',
      chain: 'INPUT',
      proto: 'all',
      destination: '2001:db8:4321::/64',
      recent: 'remove',
      rname: 'DEFAULT',
    },
  },
  'log_params' => {
    line: '-A OUTPUT -p tcp -m comment --comment "701 - log_uid, tcp-sequences and options" -j LOG --log-tcp-sequence --log-tcp-options --log-ip-options --log-uid',
    params: {
      name: '701 - log_uid, tcp-sequences and options',
      chain: 'OUTPUT',
      jump: 'LOG',
      log_uid: true,
      log_tcp_sequence: true,
      log_tcp_options: true,
      log_ip_options: true,
    },
  },
  'rpfilter_string' => {
    line: '-A PREROUTING -p tcp -m rpfilter --invert -m comment --comment "901 - set rpfilter" -j ACCEPT',
    params: {
      name: '901 - set rpfilter',
      chain: 'PREROUTING',
      action: 'accept',
      rpfilter: ['invert'],
    },
  },
  'rpfilter_array' => {
    line: '-A PREROUTING -p tcp -m rpfilter --loose --validmark --accept-local --invert -m comment --comment "900 - set rpfilter" -j ACCEPT',
    params: {
      name: '900 - set rpfilter',
      chain: 'PREROUTING',
      action: 'accept',
      rpfilter: ['loose', 'validmark', 'accept-local', 'invert'],
    },
  },
}.freeze

# This hash is for testing converting a hash to an argument line.
HASH_TO_ARGS6 = {
  'zero_prefixlen_ipv6' => {
    params: {
      name: '100 zero prefix length ipv6',
      table: 'filter',
      provider: 'ip6tables',
      source: '::/0',
      destination: '::/0',
    },
    args: ['-t', :filter, '-p', :tcp, '-m', 'comment', '--comment', '100 zero prefix length ipv6'],
  },
  'source_destination_ipv4_no_cidr' => {
    params: {
      name: '000 source destination ipv4 no cidr',
      table: 'filter',
      provider: 'ip6tables',
      source: '1.1.1.1',
      destination: '2.2.2.2',
    },
    args: ['-t', :filter, '-s', '1.1.1.1/32', '-d', '2.2.2.2/32', '-p', :tcp, '-m', 'comment', '--comment', '000 source destination ipv4 no cidr'],
  },
  'source_destination_ipv6_no_cidr' => {
    params: {
      name: '000 source destination ipv6 no cidr',
      table: 'filter',
      provider: 'ip6tables',
      source: '2001:db8:1234::',
      destination: '2001:db8:4321::',
    },
    args: ['-t', :filter, '-s', '2001:db8:1234::/128', '-d', '2001:db8:4321::/128', '-p', :tcp, '-m', 'comment', '--comment', '000 source destination ipv6 no cidr'],
  },
  'source_destination_ipv6_netmask' => {
    params: {
      name: '000 source destination ipv6 netmask',
      table: 'filter',
      provider: 'ip6tables',
      source: '2001:db8:1234::/ffff:ffff:ffff:0000:0000:0000:0000:0000',
      destination: '2001:db8:4321::/ffff:ffff:ffff:0000:0000:0000:0000:0000',
    },
    args: ['-t', :filter, '-s', '2001:db8:1234::/48', '-d', '2001:db8:4321::/48', '-p', :tcp, '-m', 'comment', '--comment', '000 source destination ipv6 netmask'],
  },
  'frag_ishasmorefrags' => {
    params: {
      name: '100 has more fragments',
      ishasmorefrags: true,
      provider: 'ip6tables',
      table: 'filter',
    },
    args: ['-t', :filter, '-p', :tcp, '-m', 'frag', '--fragid', '0', '--fragmore', '-m', 'comment', '--comment', '100 has more fragments'],
  },
  'frag_islastfrag' => {
    params: {
      name: '100 last fragment',
      islastfrag: true,
      provider: 'ip6tables',
      table: 'filter',
    },
    args: ['-t', :filter, '-p', :tcp, '-m', 'frag', '--fragid', '0', '--fraglast', '-m', 'comment', '--comment', '100 last fragment'],
  },
  'frag_isfirstfrags' => {
    params: {
      name: '100 first fragment',
      isfirstfrag: true,
      provider: 'ip6tables',
      table: 'filter',
    },
    args: ['-t', :filter, '-p', :tcp, '-m', 'frag', '--fragid', '0', '--fragfirst', '-m', 'comment', '--comment', '100 first fragment'],
  },
  'hop_limit' => {
    params: {
      name: '100 hop limit',
      hop_limit: 255,
      provider: 'ip6tables',
      table: 'filter',
    },
    args: ['-t', :filter, '-p', :tcp, '-m', 'hl', '--hl-eq', 255, '-m', 'comment', '--comment', '100 hop limit'],
  },
  'nflog' => {
    params: {
      name: '100 nflog',
      jump: 'NFLOG',
      nflog_group: '1',
      nflog_prefix: 'myprefix',
      provider: 'ip6tables',
      table: 'filter',
    },
    args: ['-t', :filter, '-p', :tcp, '-j', 'NFLOG', '--nflog-group', 1, '--nflog-prefix', 'myprefix', '-m', 'comment', '--comment', '100 nflog'],
  },
  'match_mss' => {
    params: {
      name: '604 - set_mss',
      provider: 'ip6tables',
      table: 'filter',
      chain: 'FORWARD',
      proto: 'tcp',
      tcp_flags: 'SYN,RST SYN',
      mss: '1361:1541',
      jump: 'TCPMSS',
      set_mss: '1360',
    },
    args: ['-t', :filter, '-p', :tcp, '-m', 'tcp', '--tcp-flags', 'SYN,RST', 'SYN', '-j', 'TCPMSS', '--set-mss', '1360', '-m', 'tcpmss', '--mss', '1361:1541', '-m', 'comment', '--comment', '604 - set_mss'],
  },
  'match_mss_with_synproxy' => {
    params: {
      name: '604 - proxy SYN in range',
      provider: 'ip6tables',
      table: 'filter',
      chain: 'FORWARD',
      proto: 'tcp',
      tcp_flags: 'SYN,RST SYN',
      mss: '1361:1541',
      jump: 'SYNPROXY',
      synproxy_mss: '1360',
    },
    args: ['-t', :filter, '-p', :tcp, '-m', 'tcp', '--tcp-flags', 'SYN,RST', 'SYN', '-j', 'SYNPROXY', '--mss', '1360', '-m', 'tcpmss', '--mss', '1361:1541', '-m', 'comment', '--comment', '604 - proxy SYN in range']
  },
  'creates_synproxy_rule' => {
    params: {
      name: '001 creates rule with synproxy target',
      provider: 'ip6tables',
      chain: 'INPUT',
      ensure: :present,
      dport: ['80'],
      jump: 'SYNPROXY',
      synproxy_ecn: true,
      synproxy_mss: 1460,
      synproxy_sack_perm: true,
      synproxy_timestamp: true,
      synproxy_wscale: 9,
    },
    args: ['-t', :filter, '-p', :tcp, '-m', 'multiport', '--dports', '80', '-j', 'SYNPROXY', '--sack-perm', '--timestamp', '--wscale', '9', '--mss', '1460', '--ecn', '-m', 'comment', '--comment', '001 creates rule with synproxy target'],
  },
  'creates_synproxy_rule_with_stringified_integers' => {
    params: {
      name: '001 creates rule with synproxy target',
      provider: 'ip6tables',
      chain: 'INPUT',
      ensure: :present,
      dport: ['80'],
      jump: 'SYNPROXY',
      synproxy_ecn: true,
      synproxy_mss: '1460',
      synproxy_sack_perm: true,
      synproxy_timestamp: true,
      synproxy_wscale: '9',
    },
    args: ['-t', :filter, '-p', :tcp, '-m', 'multiport', '--dports', '80', '-j', 'SYNPROXY', '--sack-perm', '--timestamp', '--wscale', '9', '--mss', '1460', '--ecn', '-m', 'comment', '--comment', '001 creates rule with synproxy target'],
  },
  'creates_synproxy_rule_with_booleans_set_false' => {
    params: {
      name: '001 creates rule with synproxy target',
      provider: 'ip6tables',
      chain: 'INPUT',
      ensure: :present,
      dport: ['80'],
      jump: 'SYNPROXY',
      synproxy_ecn: false,
      synproxy_mss: '1460',
      synproxy_sack_perm: false,
      synproxy_timestamp: false,
    },
    args: ['-t', :filter, '-p', :tcp, '-m', 'multiport', '--dports', '80', '-j', 'SYNPROXY', '--mss', '1460', '-m', 'comment', '--comment', '001 creates rule with synproxy target'],
  },
  'nflog_options_using_range' => {
    params: {
      name: '503 - test',
      provider: 'ip6tables',
      proto: 'all',
      jump:  'NFLOG',
      nflog_group: 3,
      nflog_prefix: 'TEST PREFIX',
      nflog_range: '16',
      nflog_threshold: 2,
    },
    args: ['-t', :filter, '-p', :all, '-j', 'NFLOG', '--nflog-group', 3, '--nflog-prefix', 'TEST PREFIX', '--nflog-range', '16', '--nflog-threshold', 2, '-m', 'comment', '--comment', '503 - test'],
  },
  'nflog_options_using_size' => {
    ip6tables_version: '1.6.1',
    params: {
      name: '503 - test',
      provider: 'ip6tables',
      proto: 'all',
      jump:  'NFLOG',
      nflog_group: 3,
      nflog_prefix: 'TEST PREFIX',
      nflog_size: '16',
      nflog_threshold: 2,
    },
    args: ['-t', :filter, '-p', :all, '-j', 'NFLOG', '--nflog-group', 3, '--nflog-prefix', 'TEST PREFIX', '--nflog-size', '16', '--nflog-threshold', 2, '-m', 'comment', '--comment', '503 - test'],
  },
  # NETMAP's '--to' isn't implemented for the ip6tables provider
  # 'netmap_to' => {
  #   params: {
  #     name: '569 - test',
  #     provider: 'ip6tables',
  #     table: 'nat',
  #     chain: 'POSTROUTING',
  #     destination: '3b71:db9:4321::/64',
  #     jump: 'NETMAP',
  #     to: '2001:db8:4321::1',
  #   },
  #   args: ['-t', :nat, '-d', '3b71:db9:4321::/64', '-p', :tcp, '-j', 'NETMAP', '--to', '2001:db8:4321::1', '-m', 'comment', '--comment', '569 - test'],
  # },
  'snat_to_source' => {
    params: {
      name: '568 - tosource',
      provider: 'ip6tables',
      table: 'nat',
      chain: 'POSTROUTING',
      proto: 'tcp',
      jump: 'SNAT',
      tosource: '3b71:db9:4321::3',
    },
    args: ['-t', :nat, '-p', :tcp, '-j', 'SNAT', '--to-source', '3b71:db9:4321::3', '-m', 'comment', '--comment', '568 - tosource'],
  },
  'dnat_to_dest' => {
    params: {
      name: '569 - todest',
      provider: 'ip6tables',
      table: 'nat',
      chain: 'PREROUTING',
      proto: 'tcp',
      jump: 'DNAT',
      source: '3b71:db9:1234::3',
      todest: '2001:db8:4321::1',
    },
    args: ['-t', :nat, '-s', '3b71:db9:1234::3/128', '-p', :tcp, '-j', 'DNAT', '--to-destination', '2001:db8:4321::1', '-m', 'comment', '--comment', '569 - todest'],
  },
  'redirect_to_ports' => {
    params: {
      name: '574 - toports',
      provider: 'ip6tables',
      table: 'nat',
      chain: 'PREROUTING',
      proto: 'icmp',
      jump: 'REDIRECT',
      toports: '2222',
    },
    args: ['-t', :nat, '-p', :icmp, '-j', 'REDIRECT', '--to-ports', '2222', '-m', 'comment', '--comment', '574 - toports'],
  },
  'tee_gateway' => {
    params: {
      name: '810 - tee_gateway',
      provider: 'ip6tables',
      chain: 'PREROUTING',
      table: 'mangle',
      jump: 'TEE',
      gateway: '2001:db8:4321::1',
      proto: 'all',
    },
    args: ['-t', :mangle, '-p', :all, '-j', 'TEE', '--gateway', '2001:db8:4321::1', '-m', 'comment', '--comment', '810 - tee_gateway'],
  },
  'match_time' => {
    params: {
      name: '805 - test',
      provider: 'ip6tables',
      chain: 'OUTPUT',
      proto: 'tcp',
      dport: '8080',
      date_start: '2016-01-19T04:17:07',
      date_stop: '2038-01-19T04:17:07',
      time_start: '6:00',
      time_stop: '17:00:00',
      month_days: '7',
      week_days: 'Tue',
      kernel_timezone: true,
      action: 'accept',
    },
    args: ['-t', :filter, '-p', :tcp, '-m', 'multiport', '--dports', '8080', '-j', 'ACCEPT', '-m', 'time', '--timestart', '06:00:00', '--timestop', '17:00:00', '--monthdays', '7', '--weekdays', :Tue, '--datestart', '2016-01-19T04:17:07', '--datestop', '2038-01-19T04:17:07', '--kerneltz', '-m', 'comment', '--comment', '805 - test'],
  },
  'checksum_fill' => {
    params: {
      name: '576 - test',
      provider: 'ip6tables',
      table: 'mangle',
      chain: 'POSTROUTING',
      proto: 'udp',
      outiface: 'virbr0',
      dport: '68',
      jump: 'CHECKSUM',
      checksum_fill: true,
    },
    args: ['-t', :mangle, '-o', 'virbr0', '-p', :udp, '-m', 'multiport', '--dports', '68', '-j', 'CHECKSUM', '--checksum-fill', '-m', 'comment', '--comment', '576 - test'],
  },
  'hashlimit_above' => {
    params: {
      name: '805 - hashlimit_above test',
      provider: 'ip6tables',
      proto: 'tcp',
      hashlimit_name: 'above',
      hashlimit_above: '16/sec',
      hashlimit_htable_gcinterval: '10',
      hashlimit_mode: 'srcip,dstip',
      action: 'accept',
    },
    args: ['-t', :filter, '-p', :tcp, '-j', 'ACCEPT', '-m', 'hashlimit', '--hashlimit-above', '16/sec', '--hashlimit-name', 'above', '--hashlimit-mode', 'srcip,dstip', '--hashlimit-htable-gcinterval', '10', '-m', 'comment', '--comment', '805 - hashlimit_above test'],
  },
  'hashlimit_upto' => {
    params: {
      name: '806 - hashlimit_upto test',
      provider: 'ip6tables',
      hashlimit_name: 'upto',
      hashlimit_upto: '16/sec',
      hashlimit_burst: '640',
      hashlimit_htable_size: '1000000',
      hashlimit_htable_max: '320000',
      hashlimit_htable_expire: '36000000',
      action: 'accept',
    },
    args: ['-t', :filter, '-p', :tcp, '-j', 'ACCEPT', '-m', 'hashlimit', '--hashlimit-upto', '16/sec', '--hashlimit-name', 'upto', '--hashlimit-burst', '640', '--hashlimit-htable-size', '1000000', '--hashlimit-htable-max', '320000', '--hashlimit-htable-expire', '36000000', '-m', 'comment', '--comment', '806 - hashlimit_upto test'],
  },
  'condition' => {
    params: {
      name: '010 isblue ipv4',
      provider: 'ip6tables',
      chain: 'INPUT',
      proto: 'icmp',
      condition: '! isblue',
      iniface: 'enp0s8',
      action: 'drop',
    },
    args: ['-t', :filter, '-i', 'enp0s8', '-p', :icmp, '-j', 'DROP', '-m', 'condition', '!', '--condition', 'isblue', '-m', 'comment', '--comment', '010 isblue ipv4'],
  },
  'ipsec_out_policy_ipsec' => {
    params: {
      name: '595 - ipsec_policy ipsec and out',
      provider: 'ip6tables',
      ensure: 'present',
      action: 'reject',
      chain: 'OUTPUT',
      destination: '2001:db8:4321::/64',
      ipsec_dir: 'out',
      ipsec_policy: 'ipsec',
      proto: 'all',
      reject: 'icmp-net-unreachable',
      table: 'filter',
    },
    args: ['-t', :filter, '-d', '2001:db8:4321::/64', '-p', :all, '-m', 'policy', '--dir', :out, '--pol', :ipsec, '-j', 'REJECT', '--reject-with', 'icmp-net-unreachable', '-m', 'comment', '--comment', '595 - ipsec_policy ipsec and out'],
  },
  'ipsec_in_policy_none' => {
    params: {
      name: '596 - ipsec_policy none and in',
      provider: 'ip6tables',
      ensure: 'present',
      action: 'reject',
      chain: 'INPUT',
      destination: '2001:db8:4321::/64',
      ipsec_dir: 'in',
      ipsec_policy: 'none',
      proto: 'all',
      reject: 'icmp-net-unreachable',
      table: 'filter',
    },
    args: ['-t', :filter, '-d', '2001:db8:4321::/64', '-p', :all, '-m', 'policy', '--dir', :in, '--pol', :none, '-j', 'REJECT', '--reject-with', 'icmp-net-unreachable', '-m', 'comment', '--comment', '596 - ipsec_policy none and in'],
  },
  'recent_set_rdest' => {
    params: {
      name: '597 - recent set',
      provider: 'ip6tables',
      table: 'filter',
      chain: 'INPUT',
      proto: 'all',
      destination: '2001:db8:4321::/64',
      recent: 'set',
      rdest: true,
      rname: 'list1',
    },
    args: ['-t', :filter, '-d', '2001:db8:4321::/64', '-p', :all, '-m', 'recent', '--set', '--name', 'list1', '--rdest', '-m', 'comment', '--comment', '597 - recent set'],
  },
  'recent_rcheck_complex' => {
    params: {
      name: '598 - recent rcheck',
      provider: 'ip6tables',
      table: 'filter',
      chain: 'INPUT',
      proto: 'all',
      destination: '2001:db8:4321::/64',
      recent: 'rcheck',
      rsource: true,
      rname: 'list1',
      rseconds: 60,
      rhitcount: 5,
      rttl: true,
    },
    args: ['-t', :filter, '-d', '2001:db8:4321::/64', '-p', :all, '-m', 'recent', '--rcheck', '--seconds', 60, '--hitcount', 5, '--rttl', '--name', 'list1', '--rsource', '-m', 'comment', '--comment', '598 - recent rcheck'],
  },
  'recent_update_simple' => {
    params: {
      name: '599 - recent update',
      provider: 'ip6tables',
      table: 'filter',
      chain: 'INPUT',
      proto: 'all',
      destination: '2001:db8:4321::/64',
      recent: 'update',
    },
    args: ['-t', :filter, '-d', '2001:db8:4321::/64', '-p', :all, '-m', 'recent', '--update', '-m', 'comment', '--comment', '599 - recent update'],
  },
  'recent_remove' => {
    params: {
      name: '600 - recent remove',
      provider: 'ip6tables',
      table: 'filter',
      chain: 'INPUT',
      proto: 'all',
      destination: '2001:db8:4321::/64',
      recent: 'remove',
    },
    args: ['-t', :filter, '-d', '2001:db8:4321::/64', '-p', :all, '-m', 'recent', '--remove', '-m', 'comment', '--comment', '600 - recent remove'],
  },
  'log_params' => {
    params: {
      name: '701 - log_uid, tcp-sequences and options',
      provider: 'ip6tables',
      chain: 'OUTPUT',
      jump: 'LOG',
      log_uid: true,
      log_tcp_sequence: true,
      log_tcp_options: true,
      log_ip_options: true,
    },
    args: ['-t', :filter, '-p', :tcp, '-j', 'LOG', '--log-uid', '--log-tcp-sequence', '--log-tcp-options', '--log-ip-options', '-m', 'comment', '--comment', '701 - log_uid, tcp-sequences and options'],
  },
  'rpfilter_string' => {
    kernel_version: '3.10.0',
    ip6tables_version: '1.5',
    params: {
      name: '901 - set rpfilter',
      provider: 'ip6tables',
      table: 'raw',
      chain: 'PREROUTING',
      action: 'accept',
      rpfilter: 'invert',
    },
    args: ['-t', :raw, '-p', :tcp, '-j', 'ACCEPT', '-m', 'rpfilter', '--invert', '-m', 'comment', '--comment', '901 - set rpfilter'],
  },
  'rpfilter_array' => {
    kernel_version: '3.10.0',
    ip6tables_version: '1.5',
    params: {
      name: '900 - set rpfilter',
      provider: 'ip6tables',
      table: 'raw',
      chain: 'PREROUTING',
      action: 'accept',
      rpfilter: [ 'loose', 'validmark', 'accept-local', 'invert' ],
    },
    args: ['-t', :raw, '-p', :tcp, '-j', 'ACCEPT', '-m', 'rpfilter', '--loose', '--validmark', '--accept-local', '--invert', '-m', 'comment', '--comment', '900 - set rpfilter'],
  },
}.freeze
